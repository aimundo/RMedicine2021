---
title: "Generalized additive models for longitudinal biomedical data"
subtitle: "_Beyond linear models_"  
author: 
  - "Ariel Mundo"
institute: "Department of Biomedical Engineering <br /> University of Arkansas" 
date: '08-26-2021'
output:
  xaringan::moon_reader:
    css: 
      - default
      - css/mytheme.css
      - css/mytheme-fonts.css
    seal: false
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: FALSE
      beforeInit: "macros.js"
    #includes:
     # after_body: [slides/]
---

```{r meta, echo=FALSE, warning=FALSE}
library(metathis)
meta() %>%
  meta_general(
    description = "Generalized additive models for biomedical research",
    generator = "xaringan and remark.js"
  ) %>% 
  meta_name("github-repo" = "aimundo/RMedicine2021") %>% 
  meta_social(
    title = "Generalized additive models for longitudinal biomedical data",
    #url = "https://spcanelon.github.io/xaringan-basics-and-beyond/slides/day-01-basics.html#1",
    #image = "https://raw.githubusercontent.com/spcanelon/xaringan-basics-and-beyond/main/slides/day-01-cover-image.png",
    og_type = "website",
    og_author = "Ariel Mundo",
    twitter_card_type = "summary_large_image",
    twitter_creator = "@amundortiz"
  )
```

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(icons)
library(xaringanExtra)
library(tidyverse)
library(mgcv)
library(ggplot2)
library(patchwork)
library(here)
set.seed(1) #for reproducibility
knitr::opts_chunk$set(
  fig.width=9, 
  fig.height=3.5, 
  fig.retina=3,
  #out.width = "50%",
  cache = FALSE,
  echo = TRUE,
  message = FALSE, 
  warning = FALSE,
  fig.show = TRUE,
  fig.showtext = TRUE,
  hiline = TRUE
)

xaringanExtra::use_panelset()
xaringanExtra::use_tile_view()
xaringanExtra::use_logo(
  image_url = "https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/xaringan.png"
)
xaringanExtra::style_share_again(
  share_buttons = c("twitter","linkedin")
)
```

class: title-slide, right, top
background-image: url(img/r_medicine.jpg)
background-position: 10% 75%, 75% 75%
background-size: 30%, cover

.right-column[
# `r rmarkdown::metadata$title`
### `r rmarkdown::metadata$subtitle`

**`r rmarkdown::metadata$author`**<br>
<br>
`r rmarkdown::metadata$institute` <br><br>
`r rmarkdown::metadata$date`
]



???

Welcome to the workshop on sharing your work with xaringan.

Where I'll show you how to create impressive presentation slides that can be deployed to the web for easy sharing.

---
name: about-me
layout: false
class: about-me-slide, inverse, middle, center

# About me

<img style="border-radius: 50%;" src="https://silvia.rbind.io/authors/silvia/avatar.png" width="150px"/>

## Ariel Mundo

### PhD Candidate

.fade[Department of Biomedical Engineering<br>University of Arkansas<br> Fayetteville, AR, USA]

[`r icons::fontawesome("link")` aimundo.rbind.io](https://aimundo.rbind.io)
[`r icons::fontawesome("twitter")` @amundortiz](https://twitter.com/amundortiz)
[`r icons::icon_style(icons::fontawesome("github"), scale = 1)` @aimundo](https://github.com/aimundo)

---

# Motivation

> Longitudinal studies (LS): Repeated measures on the subjects in multiple groups

--

> LS are a powerful tools because they allow to see the evolution of an effect over time

--

> Some examples of different areas of biomedical research that use longitudinal studies:

- Fertility

- Cancer

- Nutrition

---

### How do we analyze longitudinal data?

- The general rule in Biomedical Research: 

--

Repeated measures &#8594; repeated measures ANOVA (rm-ANOVA) &#8594; _post-hoc_ comparisons

--

### But what is exactly an rm-ANOVA?


\begin{equation}
y_{ijt} = \beta_0+\beta_1 \times time_{t} +\beta_2 \times treatment_{j} +\beta_3 \times time_{t}\times treatment_{j}+\varepsilon_{ijt}\\ 
\end{equation}

--
$y_{ijt}$: is the response for subject $i$ in treatment group $j$ at time $t$ </br> 
</br> 
--
$\beta_0$: the mean group value </br>
</br> 
--
$time_t$, $treatment_j$, $time_t \times treatment_j$: fixed effects of time and treatment and their interaction </br>
</br> 
--
$\beta_1, \beta_2$ and $\beta_3$: linear slopes of the fixed effects. </br> 
</br> 
--
$\varepsilon_{ijt}$: Errors that represent random variation not explained by the fixed effects, assumed to be $\sim N(0,\sigma^2)$</br>
</br> 
--
(independently and identically normally distributed with mean zero and variance $\sigma^2$).

---

### In other words...



An rm-ANOVA is a model that fits a **line** to the trend of the data!
 
.pull-left[
<img src="img/batis.gif" width="300">
]
.footnote[
_Batis et. al. 2013_
]

.pull-right[

 - It works reasonably well in certain cases
 ## But in biomedical research things don't look linear!
 ]
 

---

## Some examples
.pull-left[
<img src="img/Skala.jpg" width="500">
]
.footnote[
_Skala et. al. 2010_
]

--

.pull-right[
<img src="img/Vishwanath.jpg" width="500">
.footnote[
_Vishwanath et. al. 2009_
]
]

---
## A visual example

Some simulated data that follows trends of tumor volume reported in the literature. Simulation is useful here because we can only get a mean value from the paper. 

.pull-left[
```{r,data-plot,echo=FALSE,fig.width=7,fig.height=5}
data<-read.csv(here("data","tumor_data.csv")) #read data, mean tumor volume trend
data$Group<-as.factor(data$Group) #make Group a factor

#plot data
ggplot(data,aes(x=Day,y=Volume,group=Group,color=Group))+
    geom_line(size=2)+
    theme_classic()+
  theme(
        axis.text=element_text(size=22)
    )+
    scale_colour_viridis_d(option="turbo",end=1)


```
]

.pull-right[
```{r, simulated-data,echo=FALSE,fig.height=5,fig.width=7}
simulate_data <- function(dat, n = 10, sd = 15) {
    dat_sim <- dat %>%
        slice(rep(1:n(), each = n)) %>%
        group_by(Group, Day) %>%
        mutate(
            Vol_sim = pmax(rnorm(n, Volume, sd), 0.0001),
            subject=rep(1:10),
            subject=factor(paste(subject, Group, sep = "-"))
        ) %>%
        ungroup()

    return(dat_sim)
}

n <- 10 #number of observations (from paper)
sd <- 40 #mm3 approximate sd from paper
dat_sim <- simulate_data(data, n, sd)
breaks_s<-c(0,2,4,6,8,10,12,14) #set tick marks

#plotting simulated data
ggplot(dat_sim, aes(x = Day, y = Vol_sim, color = Group)) +
    geom_point(show.legend=FALSE,size=1.5,alpha=0.5)+
    stat_summary(aes(y = Vol_sim,
                     group=Group),
                 fun=mean, geom="line",size=1,show.legend = FALSE)+
    labs(y=expression(atop(Volume (mm^3),'(simulated)')))+
    theme_classic()+
    theme(
        axis.text=element_text(size=22)
    )+
    scale_x_continuous(breaks=breaks_s)+
    scale_colour_viridis_d(option="turbo",end=1)




```
]
---
class: center

# Acknowledgements

.pull-left[
Dr. John R. Tipton <br> <br>
Department of Mathematical Sciences, University of Arkansas

Dr. Timothy J. Muldoon <br> <br> 
Department of Biomedical Engineering, University of Arkansas
]

.pull-right[
![:scale 20%](img/nsf.png) <br> <br>
![:scale 45%](img/ABI.png)
]
